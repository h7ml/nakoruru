import{cK as t,cL as s,cM as e,cN as r,cO as i,cP as n,cQ as u,r as o,cR as a,j as c}from"./index-BYIAYquO.js";class l extends t{constructor(t,s){super(),this.client=t,this.setOptions(s),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var e;const r=this.options;this.options=this.client.defaultMutationOptions(t),s(r,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),null==(e=this.currentMutation)||e.setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(null==(t=this.currentMutation)||t.removeObserver(this))}onMutationUpdate(t){this.updateResult();const s={listeners:!0};"success"===t.type?s.onSuccess=!0:"error"===t.type&&(s.onError=!0),this.notify(s)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,s){return this.mutateOptions=s,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:void 0!==t?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:e(),s={...t,isLoading:"loading"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset};this.currentResult=s}notify(t){r.batch((()=>{var s,e,r,i;if(this.mutateOptions&&this.hasListeners())if(t.onSuccess)null==(s=(e=this.mutateOptions).onSuccess)||s.call(e,this.currentResult.data,this.currentResult.variables,this.currentResult.context),null==(r=(i=this.mutateOptions).onSettled)||r.call(i,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context);else if(t.onError){var n,u,o,a;null==(n=(u=this.mutateOptions).onError)||n.call(u,this.currentResult.error,this.currentResult.variables,this.currentResult.context),null==(o=(a=this.mutateOptions).onSettled)||o.call(a,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}t.listeners&&this.listeners.forEach((({listener:t})=>{t(this.currentResult)}))}))}}const h=i.useSyncExternalStore;function d(){}const p=t=>["userInfo",t],b=()=>({useUsersQuery:()=>{const t=u(),{message:s}=a.useApp(),{mutate:e}=function(t,s,e){const i=n(t,s,e),a=u({context:i.context}),[c]=o.useState((()=>new l(a,i)));o.useEffect((()=>{c.setOptions(i)}),[c,i]);const p=h(o.useCallback((t=>c.subscribe(r.batchCalls(t))),[c]),(()=>c.getCurrentResult()),(()=>c.getCurrentResult())),b=o.useCallback(((t,s)=>{c.mutate(t,s).catch(d)}),[c]);if(p.error&&(m=c.options.useErrorBoundary,v=[p.error],"function"==typeof m?m(...v):m))throw p.error;var m,v;return{...p,mutate:b,mutateAsync:p.mutate}}({mutationFn:t=>(async t=>{const s=await fetch(`https://jsonplaceholder.typicode.com/${t}`);return await s.json()})(t),onSuccess:()=>{t.invalidateQueries({queryKey:p()})},onError:t=>{s.error("新建失败")}});return e}});function m(){const{useUsersQuery:t}=b(),[s,e]=o.useState([]),r=t();return c.jsxs("div",{children:[c.jsx("button",{onClick:()=>{r("albums",{onSuccess:t=>{e(t)}})},children:"handleCreateProjectClick"}),null==s?void 0:s.map((t=>c.jsxs("div",{children:[c.jsx("p",{children:t.title}),c.jsx("hr",{})]},t.userId)))]})}export{m as default};
